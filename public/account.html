<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Big World account demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css">
    <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="account.css">
    <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
    <script src="face-api.min.js" id="faceApi"></script>
    </head>
  <body id="body" class="mdc-typography">

    <!-- TOP APP BAR -->
    <header id="topbar" class="mdc-top-app-bar mdc-top-app-bar--fixed">
      <div class="mdc-top-app-bar__row">
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
          <button id="navigationButton" class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
          <span class="mdc-top-app-bar__title">Big World</span>
        </section>
        
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end mdc-menu-surface--anchor" role="toolbar">
          <button id="guide" class="hidden material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">explore</button>

          <div id="energyBar" role="progressbar" class="mdc-linear-progress">
            <div class="mdc-linear-progress__buffering-dots"></div>
            <div class="mdc-linear-progress__buffer"></div>
            <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
              <span class="mdc-linear-progress__bar-inner"></span>
            </div>
            <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
              <span class="mdc-linear-progress__bar-inner"></span>
            </div>
          </div>
          <span id="energy">1.00</span>
          
          <button id="profile"
                  class="mdc-icon-button mdc-top-app-bar__action-item mdc-icon-button--on"
                  aria-label="Change account info"
                  aria-pressed="true">
            <img id="profile__image" class="mdc-icon-button__icon mdc-icon-button__icon--on" src="images/anonymous.jpg"/>
          </button>

          <!-- PROFILE MENU -->
          <div id="profilemenu" class="mdc-menu mdc-menu-surface">
            <nav class="mdc-list mdc-list--avatar-list" role="menu" aria-hidden="true" aria-orientation="vertical">

              <a href="#changeInfo" class="mdc-list-item" role="menuitem">
                <img id="profilemenu__image" class="mdc-list-item__graphic" aria-hidden="true"/>
                <span class="mdc-list-item__text">
                  <span class="mdc-list-item__primary-text">Change info</span>
                  <span id="profilemenu__name" class="mdc-list-item__secondary-text"></span>
                </span>
              </a>
              <a href="#energy" class="mdc-list-item" role="menuitem">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">battery_charging_full</i>
                <span class="mdc-list-item__text">Energy</span>
              </a>
              <hr class="mdc-list-divider">
              <a href="#registration" id="registerItem" class="mdc-list-item" role="menuitem">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">add_to_queue</i>
                <span class="mdc-list-item__text">
                  <span class="mdc-list-item__primary-text">Register User</span>
                  <span class="mdc-list-item__secondary-text">for this device</span>
                </span>
              </a>
              <a href="#login" id="loginItem" class="mdc-list-item mdc-list-item--disabled" role="menuitem">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">check_box</i>
                <span class="mdc-list-item__text">Sign in</span>
              </a>
              <a href="#logout" id="logoutItem" class="mdc-list-item mdc-list-item--disabled" role="menuitem">
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">check_box_outline_blank</i>
                <span class="mdc-list-item__text">Sign out</span>
              </a>
            </nav>
          </div>
        </section>
      </div>
    </header>
    <!-- APP DRAWER -->
    <aside id="appdrawer" class="mdc-drawer mdc-drawer--modal">
      <div class="mdc-drawer__content">        
        <nav class="mdc-list">
          <a class="mdc-list-item" href="#notImplementedDependent" aria-current="page" tabindex="0">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">add_to_home_screen</i> <!-- system_update -->
            <span class="mdc-list-item__text">Add to home screen</span>
          </a>
          <a class="mdc-list-item" href="#share">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">share</i> <!-- center_focus_weak -->
            <span class="mdc-list-item__text">Create invite link/QR code</span>
          </a>
          <a class="mdc-list-item" href="#notImplementedIndependent">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">wc</i>
            <span class="mdc-list-item__text">Another app thing</span>
          </a>
          <a class="mdc-list-item" href="#notImplementedIndependent">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">local_bar</i>
            <span class="mdc-list-item__text">Etcetera</span>
          </a>
          <hr class="mdc-list-divider">
          <a class="mdc-list-item" href="#notImplementedIndependent">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">info_outline</i>
            <span class="mdc-list-item__text">About Big World</span>
          </a>
          <a class="mdc-list-item" href="mailto:support@highfidelity.com?subject=BigWorld">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">contact_support</i>
            <span class="mdc-list-item__text">Contact support</span>
          </a>
          <a class="mdc-list-item" href="#notImplementedIndependent">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">verified_user</i> <!-- or icon: policy -->
            <span class="mdc-list-item__text">Terms of service</span>
          </a>
          <a class="mdc-list-item" href="#privacy">
            <i class="material-icons mdc-list-item__graphic" aria-hidden="true">vpn_lock</i>
            <span class="mdc-list-item__text">Privacy policy</span>
          </a>
        </nav>
      </div>
    </aside>
    <div class="mdc-drawer-scrim"></div>
    <!-- CONTENT -->
    <div class="mdc-top-app-bar--fixed-adjust">
      <h3>Demo Stuff</h3>
      <p>For demonstration purposes, this link will <a id="toggleTalking" href="#toggleTalking">stop talking</a>. (i.e., toggle the random simulated energy consumption)</p>
      <p>There is a test user named '<span id="demoHostname1">host name</span>', perhaps representing a friend, or an artist that you follow IRL. (You are currently '<span id="demoYourOwnName">your name</span>'.) You can do four things relating to the test user:
        <ul>
          <li>
            <a href="#createDemoLink">Create a demo link</a> that behaves as if <span id="demoHostname2">host name</span> had used their
            <i class="material-icons">menu</i>
            <i class="material-icons">arrow_right_alt</i>
            <i class="material-icons">share</i>
            (above) while at their current position, and given you the URL.
          </li>
          <li>Follow that <a id="demoLink">demo link (not created yet) to position ?<a></li>
          <li>Move <span id="demoHostname3">host name</span> to <a href="#demo1">position 1</a>.</li>
          <li>Move <span id="demoHostname4">host name</span> to <a href="#demo2">postion 2</a>.</li>
        </ul>
      </p>

      <h3>The Rules</h3>
      <p>The purpose of this accounts demo is to have real working code to evaluate the underlying technical requirements. It is not meant to proposing a specific UX. But clearly these interact, and so it has to start somewhere. The items marked <span class="notImplemented">in red</span> are not demonstrated in this page:
        <ul class="implemented">
          <li>Everyone is accounted for, e.g, wrt energy usage, regardless of whether registered or not. Unregistered accounts are are just not secured by a password or security-selfie, and have certain limitation such as not receiving a daily stipend. But unless noted otherwise, everyone follows the same rules.</li>
          <li>Credits are consumed by speaking, applying or resisting force, changing display name, teleporting, and by a decay of (currently) 7.5%/day, whether you're online or off.</li>
          <li>You also get a credit stipend of 60 normal-minute-use each day. With the current decay rate of 7.5%/day, you will find that if you log off for a month, you'll be approaching 800 minutes of energy, regardless of whether you started at 0 or higher. The asymptote is dailyGrant / dailyDecayFraction, e.g., 60 / 0.075 = 800.  <i>This works when we consider the daily stipend to be paid at the end of the day. (If we paid at the begining of each day - each compounding period - then a large enough decay rate sends everyone to 60, while a smaller rate ends up growing energy without bounds.)</i></li>
          <li>You can change your "strength" factor at any time, making you louder or more forceful, but making you burn credits faster while speaking or applying/resisting force.</li>
          <li>You cannnot consume credits you don't have, so regardless of "strength", your volume and force per unit time will decrease as you run very low.</li>
          <li class="notImplemented">An anonymous user will dissappear from the map when their energy becomes negligable. Registered users remain (although they might fade away after a time, TBD). In any case, users do not dissapear when they close their browser.</li>
          <li>One account per person, registered on as many browsers as they want to use. (No ui to make a second registration on same browser, and registration compares faces.) A new registered user starts with 60 minutes of credit.</li>
          <li>A registered user gets paid at a constant rate, whether or not they are in-world, an amount equal to 60 minutes of normal use. They can also buy more (or perhaps contribute resources).</li>
          <li>A registered user can create a URL to be used by their choice of N people, giving them each up to M minutes of normal use. (Default 10 minutes.) It is valid only while the host is near the spot (say 100m) they were in when they created the URL. (Host can leave and come back.) QR code is the same.</li>
          <li>When a user follows that link, they can sign in, or just remain anonymous. If the latter, they will only be able to speak or move for the M minutes paid for by their host. Registering or signing in does not get the unused portion of the original M minutes. However, N * M minutes are charged to the host as soon as they create the link (whether or not the eventual followers are registered).</li>
          <li>Pasting in a normal (non-guest) URL will show you the map, but requires you to either sign in or register.</li>
          <li>Following a URL with a location (guest URL or otherwise) puts you at your last location (or a random spawn point if none, TBD), and displays a marker to guide you to the destination. You can walk in that direction, or click the marker to teleport for a fee (say, 5 credits, regardless of distance).</li>
          <li class="notImplemented">All users (registered or not) can give credits to any user they are near (registered or not).</li>
          <li>Although this is a "single-page app", the URLs all work through reload, and back/forward buttons (while adjusting for current login state).</li>
        </ul>
      </p>
      <h3>Much more to to do</h3>
      <p>This demo is a real implementation of accounts, <i>except</i>:
        <ul class="notImplemented">
          <li>Product:
            <ul>
              <li>Whatever we decide about actual billing for invite, and keeping track of who has redeemed.</li>
              <li>Design (and do we overhaul or tweak incrementally)</li>
              <li>The computation for credits while offline needs to be broken up into intervals divided by the point in time in which you received credits from someone else.</li>
              <li>UI theme</li>
              <li>all the stuff that says "not implemented" when you click it, some of which has some interaction with identity and login</li>
              <li>language/localization</li>
              <li>accessibility. MDC has a bunch of support for Aria, but I skipped it for now. I <i>think</i> that all the stuff shown can be screen-reader accessible. (I'm also guessing that Apple or whomever comes up with a working "google glass" form-factor is going to lean on Aria or something like it.)</li>
              <li>passwordless hardware login (keyfob or touch-id), and/or "sign in with Apple". See note about passwords, below.</li>
            </ul>
          </li>
          <li>Operations:
            <ul>
              <li>Code cleanup - there's lot of hack stuff here, and bound to be bugs. (See also unit tests under "scaling", below.)</li>
              <li>failure tracking</li>
              <li>email service</li>
              <li>hubspot integration</li>              
              <li>credit card service</li>
              <li>notification (with service?) of buddy presence (also interacts with add-to-home-screen)</li>
            </ul>
          </li>
          <li>Security:
            <ul>
              <li><b>There is no mechanism here yet for "recognizing" a nearby user (e.g., to give them credits).</b> The mechanism should be provable against impersonation, not reveal PII (like email). I think it should also either not allow tracking, or let the recognized person approve/revoke the tracking. I'm confident that all this can be done with the following item, but is not implemented in the current code.</li>
              <li>crypto under the hood rather than passwords</li>
              <li>enforce energy consumption (at mixer, using authentication). The demo is consuming randomly.</li>
              <li>use hashed passwords on server, not raw. (Current is for debugging.)</li>
              <li>password storage discussion... (but let's defer until the dust settles)</li>
            </ul>
          </li>
          <li>Scaling:
            <ul>
              <li>internal server db (I'm currently using file system on server, and am working through some issues with redis.)</li>
              <li>move to highfidelity.co? aws?</li>
              <li>unit tests</li>
              <li>less data transfer (currently sending "everything" back and forth between client and server)</li>
              <li>the server-side implementation of energy-check and face-check should be good for several thousands, but not for really big numbers</li>
              <li>scale internal client db (localStorage is fine for now, but indexDb is better)</li>
            </ul>
          </li>
        </ul>
      </p>
      <!--
      <ol>
        <li>Try changing display name or spending money before registering</li>
        <li>Register, either from the above or from (user) => Register.</li>
        <li>Try updating info after registering</li>
        <li>Try logout, and updating info with or without logout.</li> 
        <li>Try multiple accounts per machine, switching accounts, and updating info from the right or wrong account. This uses a standard API that is implemented with different UIs in different browsers (and of which we do not have control). E.g., on Chrome, look at settings=>autofill=>passwords. So...</li>
        <li>Try multiple machines, or at least multiple browsers.</li>
        <li>Try making a (legit or bogus) registration on another machine (or browser).</li>
        <li>Try transfering money (and try leaving that dialog alone for 20 seconds).</li>
        <li>Try browser refresh and back/forward in various cases. There are some very subtle cases when the browser has multiple accounts stored.</li>
      </ol>
      -->
      <!--
      <h3>Passwords and Login</h3>
      <p>Quick discussion of passwords:
        <ol>
          <li>There is a W3C browser API, that everyone seems to support, for working with hardware keys. That is, instead of a password, a user can tap their separate Near-Field Communication keyfob device as authentication, or touch the fingerprint id on a MacBook touchbar. The model here is compatible with the use of this API, but I didn't bother to do so because:
            <ol>
              <li>No one has such devices. E.g., an iPhone doesn't count!</li>
              <li>I'd like to implement it anyway, but it is a <i>lot</i> of fiddly code. So I figured I'd wait until everything else gets ironed out the way we want it to be.</li>
            </ol>
          <li>There is also a W3C browser API for working with "federated credentials" from third-party providers like Google or Facebook. The model here is compatible with the use of this API, but I didn't bother to do so, because I figured that if we're so serious about privacy that we don't want to segment users or track their user experience, we certainly don't want Facebook and Google doing so!
            <p>It looks like "sign in with Apple" is a hybrid of both federated credentials and hardware keys, that appears to be secure and, if you believe Apple, private as well. From a technical and first-princples viewpoint, I <i>think</i> it would make sense to support that. However, if we do so, I am certain that some users will say, "You support sign in with Apple, I demand that you support sign in with Facebook/Twitter/Google/etc. At that point, we will have crippled our own ability to analyze failure behavior, and instead given it away to third parties. (cf <a href="https://scholarlycommons.law.northwestern.edu/cgi/viewcontent.cgi?article=1157&context=nulr" target="_blank">economic "unraveling"</a></p>
          </li>
          <li>So, that leaves passwords. There's a W3C browser API for managing that in a sensible way, which I've used where it exists. Alas, it doesn't exist on Firefox or Safari yet, so I've simulated it myself. This is what you see in the demo on these browsers. <i>However...</i> to do, I've stored the user's password in site-specific storage in the browser, rather than in the non-existent password credential manager. Is anyone going to freak about that? The alternative is to not save the password in my storage, but instead make the user enter the password each time in a form, which will be autofilled from the browser anyway. I've implemented that, too, so that you can compare. Go to <a href="https://web-connections.herokuapp.com/account.html?store-passwords=false">/account.html?store-passwords=false</a> to try out that version.</li>
        </ol>
      </p>
    -->
    </div>
    
    <!-- Dialogs  -->
    <div id="notImplementedIndependent" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="not-implement-title"
             aria-describedby="not-implemented-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="not-implement-title">Not Implemented</h2>
          <div class="mdc-dialog__content" id="not-implemented-content">
            The implementation is not likely to interact much with accounts and registration.
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>
    <div id="notImplementedDependent" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="not-implement-title"
             aria-describedby="not-implemented-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="not-implement-title">Not Implemented</h2>
          <div class="mdc-dialog__content" id="not-implemented-content">
            The implementation may interact with mechanisms shown here. We'll want to think this through sooner rather than later.
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>
    <div id="mustRegister" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="not-implement-title"
             aria-describedby="not-implemented-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="not-implement-title">Welcome :-)</h2>
          <div class="mdc-dialog__content">
            <p>You are in an open field west of a big white house with a boarded front door. There is a small mailbox here.</p>
            <p>Actually, you've arrived without an invite. You have no energy, and can't do anything. Either get an invite, or <a href="#registration">register</a>.</p>
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>
    <div id="privacy" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="not-implement-title"
             aria-describedby="not-implemented-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="not-implement-title">Privacy</h2>
          <div class="mdc-dialog__content" id="not-implemented-content">
            <p>Not implemented yet, except...</p>
            <p>It is debatable whether a delete-your-account! button (for signed-in users) should be here, or in the user menu. Regardless, the button is real - partly because it interacts with a lot of the semantics of accounts, and partly because it's useful to have during testing.</p>
            <p>
              <button id="forgetMe" class="mdc-button mdc-button--raised">
                <i class="material-icons mdc-button__icon">voice_over_off</i>
                <span class="mdc-button__label">forget me</span>
              </button> will delete your account on our servers, and sign you out. (You can re-register later after <i>[period of time, currently zero]</i>.) <b>You will probably also want to tell your browser to forget the information for this site.</b> (We can't do that.) See your browser's documentation for site passwords.
            </p>
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <div id="destinationGuide" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface" role="alertdialog">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title">Destination</h2>
          <div class="mdc-dialog__content">
            <p>You have been invited by <span id="destinationHost"></span> to visit near <span id="destinationLocation"></span>, but you are at <span id="yourLocation"></span>.</p>
            <p>The guide isn't implemented yet. In the app, it should point you in the right direction, and give you the distance.</p>
            <p>You also have the option to teleport there directly for a cost of 5 energy units.</p>
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">teleport</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <div id="share" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface" role="alertdialog">
          <h2 class="mdc-dialog__title">Share</h2>
          <div class="mdc-dialog__content">
            <p class="onlyShareRegistered">This URL (in this QR code and Copy Link button) can only be followed by <i>registered</i> users. You can also sponsor <i>new</i> users using the form below.</p>
            <p class="onlyShareAnyone">This QR code and Copy Link button are for anyone.</p>
            <div id="qr"></div>

            <textarea id="inviteUrl" readonly></textarea>

            <button id="copyUrl" class="mdc-button">
              <div class="mdc-button__ripple"></div>
              <i class="material-icons mdc-button__icon" aria-hidden="true">file_copy</i>
              <span class="mdc-button__label">Copy Link</span>
            </button>

            <p class="onlyUnregistered">You can only <i>sponsor</i> new users if you are <a href="#registration">registered</a>.</p>
            <form id="share__form">
              <fieldset id="share__fieldset">
                <legend class="mdc-typography mdc-typography--body2">Sponsored Users</legend>
                <ul class="mdc-list list--floating-height">

                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="nFollowers__label" class="mdc-text-field mdc-text-field--outlined" for="nFollowers">
                        <input id="nFollowers" type="number" class="mdc-text-field__input" aria-labelledby="nFollowers__floatingLabel" autocomplete="nickname given-name name" required min="1" step="1" tabindex="0" value="1">
                        <div id="nFollowers__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="nFollowers__floatingLabel" class="mdc-floating-label">Number of Followers</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">the number of people who can follow the link</div>
                      </div>
                    </div>
                  </li>

                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="followerCredits__label" class="mdc-text-field mdc-text-field--outlined" for="followerCredits">
                        <input id="followerCredits" type="number" class="mdc-text-field__input" aria-labelledby="followerCredits__floatingLabel" autocomplete="nickname given-name name" required min="10" step="1" value="10">
                        <div id="followerCredits__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="followerCredits__floatingLabel" class="mdc-floating-label">Minutes of normal use</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">credits that each such follower can use while unregistered</div>
                      </div>
                    </div>
                  </li>

                  <li class="mdc-list-item">
                    Total: <span id="inviteTotal">10</span>
                  </li>
                </ul>
                <input type="submit" class="mdc-button" value="sponsor">
              </fieldset>
            </form>

          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">OK</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <div id="selectUser" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="selectUser-title"
             aria-describedby="selectUser-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="selectUser-title"><span id="selectUser__context">Sign in</span> as</h2>
          <div class="mdc-dialog__content">
            <template id="selectUserTemplate">
              <li class="mdc-list-item">
                <img class="mdc-list-item__graphic" aria-hidden="true" />
                <span class="mdc-list-item__text">
                  <span class="mdc-list-item__primary-text"></span>
                  <span class="mdc-list-item__secondary-text"></span>
                </span>
              </li>
              <li class="mdc-list-item">
                <div class="list-item__text-field-container">
                  <label id="selectPassword__label" class="mdc-text-field mdc-text-field--outlined mdc-text-field--with-trailing-icon" for="password">
                    <input id="selectPassword" type="password" class="mdc-text-field__input" aria-labelledby="password__floatingLabel" autocomplete="off" required>
                    <button id="selectPasswordVisibility" class="mdc-icon-button material-icons mdc-text-field__icon mdc-text-field__icon--trailing">visibility</button>
                    <div id="selectPassword__outline" class="mdc-notched-outline">
                      <div class="mdc-notched-outline__leading"></div>
                      <div class="mdc-notched-outline__notch">
                        <span id="selectPassword__floatingLabel" class="mdc-floating-label">Password</span>
                      </div>
                      <div class="mdc-notched-outline__trailing"></div>
                    </div>
                  </label>
                </div>
              </li>
            </template>
            <ul id="selectUser__list" class="mdc-list mdc-list--two-line mdc-list--avatar-list">
            </ul>
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">cancel</span>
            </button>
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">sign in</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>
    
    <div id="credits" class="mdc-dialog">
      <form id="buyEnergy" class="mdc-dialog__container">
        
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="credits-title"
             aria-describedby="credits-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="credits-title">Energy</h2>
          <div class="mdc-dialog__content" id="credits-content">
            <p>The louder you speak, or the faster you move, the more energy you consume. When you run out, you cannot speak or move.</p>
            <p>Your energy level is shown by the solid white bar at top of the page. For example, your current level is <span id="energyAmount"></span>%.</p>
            <p>Your rate of energy consumption is shown by the moving green bar.</p>
            <p>Registered users have their energy replenished automatically. Registered users can also earn extra energy for free by contributing their <a href="https://web-connections.herokuapp.com/credits.html">idle computers</a>, or simply buy extra energy with a credit card.</p>
            <p class="onlyUnregistered">To get more energy, you must <a href="#registration">register</a> (for free).</p>

            <fieldset id="buyEnergy__fieldset" disabled>
              <legend class="mdc-typography mdc-typography--body2">
                Energy credits can be purchased in units of $1.00.
              </legend>
              <ul id="buyEnergy__list" class="mdc-list mdc-list--non-interactive list--floating-height">
                <li class="mdc-list-item">
                  <div class="list-item__text-field-container">
                    <label id="selectedCard__label" class="mdc-text-field mdc-text-field--outlined" for="selectedCard">
                      <input id="selectedCard" type="text" class="mdc-text-field__input" aria-labelledby="selectedCard__floatingLabel" disabled>
                      <div id="selectedCard__outline" class="mdc-notched-outline">
                        <div class="mdc-notched-outline__leading"></div>
                        <div class="mdc-notched-outline__notch">
                          <span id="selectedCard__floatingLabel" class="mdc-floating-label"><i class="notImplementedDependent">Credit card stuff Not Implemented </i></span>
                        </div>
                        <div class="mdc-notched-outline__trailing"></div>
                      </div>
                    </label>
                  </div>
                </li>

                <li class="mdc-list-item">
                  <div class="list-item__text-field-container">
                    <label id="purchaseAmount__label" class="mdc-text-field mdc-text-field--outlined" for="purchaseAmount">
                      <input id="purchaseAmount" type="number" class="mdc-text-field__input" aria-labelledby="purchaseAmount__floatingLabel" autocomplete="off" required min="1" step="1" max="100">
                      <div id="purchaseAmount__outline" class="mdc-notched-outline">
                        <div class="mdc-notched-outline__leading"></div>
                        <div class="mdc-notched-outline__notch">
                          <span id="purchaseAmount__floatingLabel" class="mdc-floating-label">Purchase Amount</span>
                        </div>
                        <div class="mdc-notched-outline__trailing"></div>
                      </div>
                    </label>
                  </div>
                </li>
              </ul>
            </fieldset>
          </div>

          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">cancel</span>
            </button>
            <input type="submit" class="mdc-button mdc-dialog__button" value="submit">
          </footer>
        </div>
      </form>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <!-- REGISTRATION -->
    <div id="registration" class="mdc-dialog">
      <form id="registrationForm" class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="registration__title"
             aria-describedby="registration-content">
            
            <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
            <h2 class="mdc-dialog__title" id="registration__title"><span class="onlyUpdate">Update</span><span class="onlyNewRegistration">Registration</span></h2>
            <div class="mdc-dialog__content" id="registration-content">
              <div class="onlyNewRegistration">
                <p>Registration is free. Only registered users can invite others or get more <a href="#energy">energy</a>.</p>
              </div>

              <fieldset>
                <legend class="mdc-typography mdc-typography--body2">
                      Public - visible to others
                </legend>
                <ul id="loginPublic__list" class="mdc-list mdc-list--non-interactive list--floating-height">
                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="displayName__label" class="mdc-text-field mdc-text-field--outlined" for="displayName">
                        <input id="displayName" type="text" class="mdc-text-field__input" aria-labelledby="displayName__floatingLabel" autocomplete="nickname given-name name" required tabindex="0">
                        <div id="displayName__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="displayName__floatingLabel" class="mdc-floating-label">Display name</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">displayed to other users when<span class="onlyUnregistered"> they are close to you</span><span class="onlyRegistered"> close - <b>changing uses 10 energy units</b></div>
                      </div>
                    </div>
                  </li>
                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="strength__label" class="mdc-text-field mdc-text-field--outlined" for="strength">
                        <input id="strength" type="number" class="mdc-text-field__input" aria-labelledby="strength__floatingLabel" autocomplete="nickname given-name name" required tabindex="0" min="0" step="1" max="5" value="1">
                        <div id="strength__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="strength__floatingLabel" class="mdc-floating-label">strength multiplier</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">for volume, acceleration, and mass (limited by your available <a href="#energy">energy</a>)</div>
                      </div>
                    </div>
                  </li>
                </ul>
              </fieldset>

              <fieldset class="notUnregisteredUpdate">
                <legend class="mdc-typography mdc-typography--body2">
                  Private - not shared with anyone
                </legend>
                <ul id="loginPrivate__list" class="mdc-list mdc-list--non-interactive list--floating-height">
                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="email__label" class="mdc-text-field mdc-text-field--outlined" for="email">
                        <input id="email" type="email" class="mdc-text-field__input" aria-labelledby="email__floatingLabel" autocomplete="email" required>
                        <input id="oldEmail" type="hidden">
                        <input id="oldPassword" type="hidden">
                        <div id="email__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="email__floatingLabel" class="mdc-floating-label">Email</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">used to send information about your account</div>
                      </div>
                    </div>
                  </li>

                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="password__label" class="mdc-text-field mdc-text-field--outlined mdc-text-field--with-trailing-icon" for="password">
                        <input id="password" type="password" class="mdc-text-field__input" aria-labelledby="password__floatingLabel" autocomplete="new-password">
                        <button id="passwordVisibility" class="mdc-icon-button material-icons mdc-text-field__icon mdc-text-field__icon--trailing">visibility</button>
                        <div id="password__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="password__floatingLabel" class="mdc-floating-label">Password</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">verified before making changes and transfers</div>
                      </div>
                    </div>
                  </li>

                  <li class="mdc-list-item">
                    <div class="list-item__text-field-container">
                      <label id="face__label" class="mdc-text-field mdc-text-field--outlined mdc-text-field--with-trailing-icon" for="face">
                        <input id="face" type="text" class="mdc-text-field__input" aria-labelledby="face__floatingLabel" required autocomplete="off">
                        <img id="face__image" class="mdc-list-item__graphic hidden"/>
                        <button id="faceCamera" class="mdc-icon-button material-icons mdc-text-field__icon mdc-text-field__icon--trailing">photo_camera</button>
                        <div id="face__outline" class="mdc-notched-outline">
                          <div class="mdc-notched-outline__leading"></div>
                          <div class="mdc-notched-outline__notch">
                            <span id="face__floatingLabel" class="mdc-floating-label">Security selfie</span>
                          </div>
                          <div class="mdc-notched-outline__trailing"></div>
                        </div>
                      </label>
                      <div class="mdc-text-field-helper-line">
                        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" aria-hidden="true">verifies large transactions, and prevents duplicate accounts</div>
                      </div>
                    </div>
                  </li>
                  
                </ul>
              </fieldset>
              <div class="onlyUnregisteredUpdate">
                <p>Or you can <a href="#registration">register</a> for free. Only registered users can invite others or get more <a href="#energy">energy</a>.</p>
              </div>

              
            </div>
            <footer class="mdc-dialog__actions">
              <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
                <div class="mdc-button__ripple"></div>
                <span class="mdc-button__label">cancel</span>
              </button>
              <!-- value used as button name, which default on Firefox to "Submit Query" -->
              <input type="submit" class="mdc-button mdc-dialog__button" id="register__submit" value="Register">
            </footer>
        </div>
      </form>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <!-- After registration so drawn on top -->
    <div id="webcam" class="mdc-dialog">
      <div class="mdc-dialog__container">
        <div class="mdc-dialog__surface"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="not-implement-title"
             aria-describedby="not-implemented-content">
          <!-- Title cannot contain leading whitespace due to mdc-typography-baseline-top() -->
          <h2 class="mdc-dialog__title" id="not-implement-title">Security Selfie - Sound on, please</h2>
          <div class="mdc-dialog__content">
            <div class="overlaidMedia">
              <video id="webcamVideo" autoplay playsinline></video>
              <canvas id="videoOverlay"></canvas>
            </div>
          </div>
          <footer class="mdc-dialog__actions">
            <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">skip registration</span>
            </button>
          </footer>
        </div>
      </div>
      <div class="mdc-dialog__scrim"></div>
    </div>

    <!-- SNACKBARS are last so they are on top of all -->
    <div id="loggedOut" class="mdc-snackbar">
      <div class="mdc-snackbar__surface">
        <div class="mdc-snackbar__label"
             role="status"
             aria-live="polite">
          Signed out.
        </div>
        <div class="mdc-snackbar__actions">
          <button type="button" class="mdc-button mdc-snackbar__action">
            <span class="mdc-button__label">Sign in</span>
          </button>
        </div>
      </div>
    </div>

    <div id="arrived" class="mdc-snackbar">
      <div class="mdc-snackbar__surface">
        <div id="arrived__label" class="mdc-snackbar__label" role="status" aria-live="polite">
          You have arrived.
        </div>
        <div class="mdc-snackbar__actions">
          <button type="button" class="mdc-button mdc-snackbar__action">
            <span class="mdc-button__label">cancel</span>
          </button>
        </div>
      </div>
    </div>

    <div id="signingIn" class="mdc-snackbar">
      <div class="mdc-snackbar__surface">
        <div class="mdc-snackbar__label"
             role="status"
             id="signingIn__label"
             aria-live="polite"></div>
        <div class="mdc-snackbar__actions">
          <button class="material-icons mdc-icon-button mdc-snackbar__action">cancel</button>
        </div>
      </div>
    </div>
    <div id="changed" class="mdc-snackbar">
      <div class="mdc-snackbar__surface">
        <div class="mdc-snackbar__label"
             id="changed__label"
             role="status"
             aria-live="polite"></div>
        <div class="mdc-snackbar__actions">
          <button class="material-icons mdc-icon-button mdc-snackbar__action">cancel</button>
        </div>
      </div>
    </div>
    <div id="registrationFail" class="mdc-snackbar mdc-snackbar--stacked">
      <div class="mdc-snackbar__surface">
        <div class="mdc-snackbar__label"
             role="status"
             aria-live="polite">
        </div>
        <div class="mdc-snackbar__actions">
          <button class="material-icons mdc-icon-button mdc-snackbar__action">cancel</button>
        </div>
      </div>
    </div>
    
    <script src="account.js"></script>
    <script src="qrcode.js"></script>
  </body>
</html>
